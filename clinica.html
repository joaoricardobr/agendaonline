<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SMO - Fast Performance</title>
    
    <!-- Ícones e Fontes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Libs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #64748b;
            --background: #f1f5f9;
            --surface: #ffffff;
            --text-main: #0f172a;
            --text-muted: #94a3b8;
            --border: #e2e8f0;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --radius: 12px;
            --sidebar-width: 250px;
            --header-height: 65px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            font-size: 14px;
        }

        /* --- SKELETON LOADING (Para parecer rápido) --- */
        .skeleton {
            background: #e2e8f0;
            background: linear-gradient(90deg, #e2e8f0 25%, #f1f5f9 50%, #e2e8f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 6px;
        }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        /* --- LOGIN --- */
        .login-overlay {
            position: fixed; inset: 0; background: linear-gradient(135deg, var(--primary), #8b5cf6);
            display: flex; align-items: center; justify-content: center; z-index: 9999;
        }
        .login-box {
            background: white; padding: 40px; border-radius: 20px; width: 90%; max-width: 380px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2); text-align: center;
        }
        .login-input {
            width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid var(--border);
            border-radius: 8px; background: #f8fafc;
        }
        .btn-login {
            width: 100%; padding: 12px; background: var(--primary); color: white; border: none;
            border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s;
        }
        .btn-login:hover { background: var(--primary-dark); }

        /* --- LAYOUT --- */
        .app { display: flex; height: 100vh; }
        
        .sidebar {
            width: var(--sidebar-width); background: var(--surface); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; z-index: 50;
        }
        .logo-area {
            height: var(--header-height); display: flex; align-items: center; padding: 0 20px;
            font-weight: 800; font-size: 18px; color: var(--primary); border-bottom: 1px solid var(--border);
        }
        .nav-menu { padding: 20px 10px; flex: 1; }
        .nav-item {
            padding: 12px 15px; display: flex; align-items: center; gap: 10px; color: var(--secondary);
            border-radius: 8px; cursor: pointer; margin-bottom: 5px; font-weight: 500; transition: 0.2s;
        }
        .nav-item:hover { background: #f1f5f9; color: var(--primary); }
        .nav-item.active { background: #e0e7ff; color: var(--primary); }
        
        .main { flex: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; }

        /* --- HEADER & SEARCH --- */
        .header {
            height: var(--header-height); background: var(--surface); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between; padding: 0 25px;
        }
        .search-container {
            position: relative; width: 400px;
        }
        .search-icon {
            position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted);
        }
        .search-input {
            width: 100%; padding: 10px 10px 10px 38px; border: 1px solid var(--border);
            border-radius: 50px; background: #f8fafc; outline: none; transition: 0.2s;
        }
        .search-input:focus { border-color: var(--primary); background: white; box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }

        /* --- CONTENT --- */
        .content-body { flex: 1; overflow-y: auto; padding: 25px; }
        .section { display: none; }
        .section.active { display: block; animation: fadeUp 0.3s; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- DASHBOARD --- */
        .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .card { background: var(--surface); padding: 20px; border-radius: var(--radius); box-shadow: 0 2px 4px rgba(0,0,0,0.04); border: 1px solid var(--border); }
        .stat-val { font-size: 24px; font-weight: 700; color: var(--text-main); margin-top: 5px; }
        .stat-label { font-size: 12px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; }

        /* --- TABLES --- */
        .table-wrap { background: var(--surface); border-radius: var(--radius); border: 1px solid var(--border); overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8fafc; padding: 14px 20px; text-align: left; font-size: 12px; font-weight: 600; color: var(--text-muted); }
        td { padding: 14px 20px; border-top: 1px solid var(--border); vertical-align: middle; }
        tr:hover td { background: #f8fafc; }

        .badge { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 700; }
        .badge-yellow { background: #fffbeb; color: #b45309; }
        .badge-green { background: #f0fdf4; color: #15803d; }
        .badge-blue { background: #eff6ff; color: #1d4ed8; }
        .badge-red { background: #fef2f2; color: #b91c1c; }

        /* --- FORMS --- */
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; margin-bottom: 15px; }
        label { display: block; font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: 5px; }
        .form-control { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; outline: none; }
        .btn { padding: 10px 20px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-outline { background: white; border: 1px solid var(--border); color: var(--text-main); }
        .btn-sm { padding: 6px 10px; font-size: 12px; }

        /* --- TOAST --- */
        .toast { position: fixed; top: 20px; right: 20px; background: #1e293b; color: white; padding: 12px 20px; border-radius: 8px; z-index: 5000; opacity: 0; pointer-events: none; transition: 0.3s; transform: translateY(-10px); }
        .toast.show { opacity: 1; transform: translateY(0); }

        @media (max-width: 768px) {
            .sidebar { position: fixed; left: -100%; height: 100%; transition: 0.3s; box-shadow: 10px 0 20px rgba(0,0,0,0.1); }
            .sidebar.open { left: 0; }
            .search-container { width: 100%; display: none; } /* Oculta busca no mobile header pra simplificar */
        }
    </style>
</head>
<body>

    <!-- LOGIN -->
    <div id="loginScreen" class="login-overlay">
        <div class="login-box">
            <div style="font-size: 40px; color: var(--primary); margin-bottom: 15px;"><i class="fas fa-heartbeat"></i></div>
            <h2 style="margin-bottom: 10px;">Acesso Médico</h2>
            <p style="color: var(--text-muted); margin-bottom: 25px;">Sistema otimizado V3.0</p>
            <form id="loginForm">
                <input type="email" id="email" class="login-input" placeholder="Email" required>
                <input type="password" id="password" class="login-input" placeholder="Senha" required>
                <button type="submit" class="btn-login" id="btnLogin">Entrar</button>
            </form>
            <div style="margin-top: 15px; font-size: 12px; color: #666; cursor: pointer;" id="toggleRegister">Não tem conta? Criar agora.</div>
        </div>
    </div>

    <!-- APP -->
    <div id="appScreen" class="app" style="display: none;">
        <aside class="sidebar" id="sidebar">
            <div class="logo-area">
                <i class="fas fa-clinic-medical" style="margin-right: 10px;"></i> SMO
            </div>
            <nav class="nav-menu">
                <div class="nav-item active" onclick="nav('dashboard')"><i class="fas fa-chart-pie"></i> Dashboard</div>
                <div class="nav-item" onclick="nav('agenda')"><i class="fas fa-calendar-alt"></i> Agenda</div>
                <div class="nav-item" onclick="nav('novo')"><i class="fas fa-plus-circle"></i> Novo Paciente</div>
                <div class="nav-item" onclick="nav('relatorios')"><i class="fas fa-file-alt"></i> Relatórios</div>
            </nav>
            <div style="padding: 20px; border-top: 1px solid var(--border);">
                <div class="nav-item" style="color: var(--danger);" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Sair</div>
            </div>
        </aside>

        <main class="main">
            <header class="header">
                <button onclick="document.getElementById('sidebar').classList.toggle('open')" style="background:none; border:none; font-size:20px; display:none;" class="mobile-menu"><i class="fas fa-bars"></i></button>
                
                <!-- BARRA DE PESQUISA -->
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" class="search-input" placeholder="Buscar paciente por nome, médico ou data...">
                </div>

                <div style="display: flex; align-items: center; gap: 10px;">
                    <div style="text-align: right;">
                        <div style="font-weight: 700;">Dra. Soraya</div>
                        <div style="font-size: 11px; color: var(--text-muted);">Online</div>
                    </div>
                    <div style="width: 35px; height: 35px; background: var(--primary); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center;">DS</div>
                </div>
            </header>

            <div class="content-body">
                
                <!-- DASHBOARD -->
                <div id="dashboard" class="section active">
                    <h2 style="margin-bottom: 20px;">Visão Geral</h2>
                    <div class="stats-row">
                        <div class="card">
                            <div class="stat-label">Total Pacientes</div>
                            <div class="stat-val" id="countTotal"><div class="skeleton" style="width: 50px; height: 30px;"></div></div>
                        </div>
                        <div class="card">
                            <div class="stat-label">Aguardando</div>
                            <div class="stat-val" id="countPending"><div class="skeleton" style="width: 50px; height: 30px;"></div></div>
                        </div>
                        <div class="card">
                            <div class="stat-label">Atendidos</div>
                            <div class="stat-val" id="countDone"><div class="skeleton" style="width: 50px; height: 30px;"></div></div>
                        </div>
                        <div class="card">
                            <div class="stat-label">Receita Est.</div>
                            <div class="stat-val" id="countRevenue"><div class="skeleton" style="width: 80px; height: 30px;"></div></div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; height: 350px;">
                        <div class="card" style="display: flex; align-items: center; justify-content: center;">
                            <canvas id="chartStatus"></canvas>
                        </div>
                        <div class="card" style="overflow-y: auto;">
                            <h4 style="margin-bottom: 15px;">Últimos Agendamentos</h4>
                            <div id="recentList">
                                <!-- Skeleton Items -->
                                <div class="skeleton" style="height: 40px; margin-bottom: 10px;"></div>
                                <div class="skeleton" style="height: 40px; margin-bottom: 10px;"></div>
                                <div class="skeleton" style="height: 40px; margin-bottom: 10px;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AGENDA -->
                <div id="agenda" class="section">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                        <h2>Minha Agenda</h2>
                        <button class="btn btn-outline" onclick="loadAppointments(true)"><i class="fas fa-sync"></i> Atualizar</button>
                    </div>
                    
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Paciente</th>
                                    <th>Data</th>
                                    <th>Médico</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <!-- Preenchido via JS -->
                            </tbody>
                        </table>
                    </div>
                    <p style="text-align: center; color: var(--text-muted); margin-top: 10px; font-size: 12px;">Mostrando os 50 agendamentos mais recentes para performance.</p>
                </div>

                <!-- NOVO -->
                <div id="novo" class="section">
                    <div class="card" style="max-width: 800px; margin: 0 auto;">
                        <h3 style="margin-bottom: 20px;">Ficha de Paciente</h3>
                        <form id="formApp">
                            <input type="hidden" id="editId">
                            <div class="form-grid">
                                <div><label>Nome</label><input type="text" id="nome" class="form-control" required></div>
                                <div><label>Telefone</label><input type="text" id="tel" class="form-control"></div>
                                <div><label>Email</label><input type="email" id="mail" class="form-control"></div>
                            </div>
                            <div class="form-grid">
                                <div>
                                    <label>Médico</label>
                                    <input type="text" id="medico" list="medicosList" class="form-control">
                                    <datalist id="medicosList"></datalist>
                                </div>
                                <div><label>Data</label><input type="date" id="data" class="form-control"></div>
                                <div><label>Hora</label><input type="time" id="hora" class="form-control"></div>
                            </div>
                            <div class="form-grid">
                                <div><label>Procedimento</label><input type="text" id="proc" class="form-control"></div>
                                <div>
                                    <label>Status</label>
                                    <select id="status" class="form-control">
                                        <option>Aguardando Atendimento</option>
                                        <option>Atendido</option>
                                        <option>Reagendado</option>
                                        <option>Cancelado</option>
                                    </select>
                                </div>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <label>Observações</label>
                                <textarea id="obs" class="form-control" rows="3"></textarea>
                            </div>
                            <div style="text-align: right;">
                                <button type="button" class="btn btn-outline" onclick="resetForm()">Limpar</button>
                                <button type="submit" class="btn btn-primary" id="btnSave">Salvar</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- RELATORIOS -->
                <div id="relatorios" class="section">
                    <h2>Relatórios</h2>
                    <p>Funcionalidade simplificada para performance.</p>
                </div>

            </div>
        </main>
    </div>

    <div id="toast" class="toast">Mensagem</div>

    <!-- SCRIPT FIREBASE OTIMIZADO -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
        import { getFirestore, collection, query, orderBy, limit, getDocs, addDoc, updateDoc, deleteDoc, doc, setDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

        // CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyBxPLohS2xOErPb8FH0cFRnNzxy699KHUM",
            authDomain: "agendaunica-fb0ea.firebaseapp.com",
            projectId: "agendaunica-fb0ea",
            storageBucket: "agendaunica-fb0ea.firebasestorage.app",
            messagingSenderId: "1060358457274",
            appId: "1:1060358457274:web:99f18e2c7e1e889e547f83",
            measurementId: "G-L8C2KQZMH7"
        };

        // INIT
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // STATE
        let allAppointments = []; // Armazena os 50 mais recentes
        let isLoginMode = true;
        let chart = null;

        // AUTH LISTENER
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('appScreen').style.display = 'flex';
                loadAppointments(); // Carrega dados
            } else {
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('appScreen').style.display = 'none';
            }
        });

        // --- CORE FUNCTIONS (OTIMIZADAS) ---

        // 1. CARREGAMENTO RÁPIDO (LIMIT 50)
        async function loadAppointments(force = false) {
            if (!force && allAppointments.length > 0) return; // Cache simples

            try {
                // TRUQUE DE PERFORMANCE: Ordena por data e pega só os 50 últimos.
                // Isso evita baixar o banco todo e travar o PC.
                const q = query(collection(db, "appointments"), limit(50));
                
                const snapshot = await getDocs(q);
                allAppointments = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                
                // Ordena localmente para garantir (caso o index do firebase falhe)
                allAppointments.sort((a,b) => new Date(b.dataConsulta || 0) - new Date(a.dataConsulta || 0));

                renderTable(allAppointments);
                updateDashboard();
            } catch (error) {
                console.error(error);
                showToast("Erro ao carregar dados. Verifique console.");
            }
        }

        // 2. BUSCA LOCAL INSTANTÂNEA
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            if(term === '') {
                renderTable(allAppointments);
                return;
            }
            
            // Filtra o array que já está na memória (Zero delay)
            const filtered = allAppointments.filter(app => 
                (app.nomePaciente && app.nomePaciente.toLowerCase().includes(term)) ||
                (app.nomeMedico && app.nomeMedico.toLowerCase().includes(term)) ||
                (app.dataConsulta && app.dataConsulta.includes(term))
            );
            renderTable(filtered);
        });

        // 3. RENDERIZAÇÃO DA TABELA
        function renderTable(data) {
            const tbody = document.getElementById('tableBody');
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding: 20px;">Nenhum registro encontrado.</td></tr>';
                return;
            }

            tbody.innerHTML = data.map(app => `
                <tr>
                    <td style="font-weight:600">${app.nomePaciente}</td>
                    <td>${app.dataConsulta || '-'} <small style="color:#999">${app.horaConsulta || ''}</small></td>
                    <td>${app.nomeMedico || '-'}</td>
                    <td><span class="badge ${getBadge(app.status)}">${app.status}</span></td>
                    <td>
                        <button class="btn-sm btn-outline" onclick="window.edit('${app.id}')"><i class="fas fa-pen"></i></button>
                        <button class="btn-sm btn-outline" style="color:red" onclick="window.del('${app.id}')"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function getBadge(status) {
            if(!status) return 'badge-blue';
            if(status.includes('Aguardando')) return 'badge-yellow';
            if(status.includes('Atendido')) return 'badge-green';
            if(status.includes('Cancelado')) return 'badge-red';
            return 'badge-blue';
        }

        // 4. CRUD (Create, Update, Delete)
        document.getElementById('formApp').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btnSave');
            btn.innerHTML = 'Salvando...'; btn.disabled = true;

            const id = document.getElementById('editId').value;
            const data = {
                nomePaciente: document.getElementById('nome').value,
                telefone: document.getElementById('tel').value,
                email: document.getElementById('mail').value,
                nomeMedico: document.getElementById('medico').value,
                dataConsulta: document.getElementById('data').value,
                horaConsulta: document.getElementById('hora').value,
                procedimentos: document.getElementById('proc').value,
                status: document.getElementById('status').value,
                descricao: document.getElementById('obs').value
            };

            try {
                if (id) {
                    await updateDoc(doc(db, "appointments", id), data);
                    const idx = allAppointments.findIndex(a => a.id === id);
                    if(idx !== -1) allAppointments[idx] = { id, ...data };
                    showToast("Atualizado!");
                } else {
                    const ref = await addDoc(collection(db, "appointments"), data);
                    allAppointments.unshift({ id: ref.id, ...data });
                    showToast("Criado!");
                }
                resetForm();
                renderTable(allAppointments);
                updateDashboard();
                nav('agenda');
            } catch (err) {
                showToast("Erro: " + err.message);
            } finally {
                btn.innerHTML = 'Salvar'; btn.disabled = false;
            }
        });

        window.edit = (id) => {
            const app = allAppointments.find(a => a.id === id);
            if (!app) return;
            document.getElementById('editId').value = id;
            document.getElementById('nome').value = app.nomePaciente;
            document.getElementById('tel').value = app.telefone;
            document.getElementById('mail').value = app.email;
            document.getElementById('medico').value = app.nomeMedico;
            document.getElementById('data').value = app.dataConsulta;
            document.getElementById('hora').value = app.horaConsulta;
            document.getElementById('proc').value = app.procedimentos;
            document.getElementById('status').value = app.status;
            document.getElementById('obs').value = app.descricao;
            nav('novo');
        };

        window.del = async (id) => {
            if (confirm('Deletar?')) {
                await deleteDoc(doc(db, "appointments", id));
                allAppointments = allAppointments.filter(a => a.id !== id);
                renderTable(allAppointments);
                updateDashboard();
                showToast("Deletado.");
            }
        };

        // 5. DASHBOARD UPDATE
        function updateDashboard() {
            // Contagens
            const total = allAppointments.length;
            const pending = allAppointments.filter(a => a.status === 'Aguardando Atendimento').length;
            const done = allAppointments.filter(a => a.status === 'Atendido').length;
            
            document.getElementById('countTotal').innerText = total;
            document.getElementById('countPending').innerText = pending;
            document.getElementById('countDone').innerText = done;
            document.getElementById('countRevenue').innerText = `R$ ${(total * 300).toLocaleString()}`; // Estimativa

            // Lista Recente
            const recent = allAppointments.slice(0, 3);
            const recentDiv = document.getElementById('recentList');
            if (recent.length === 0) {
                recentDiv.innerHTML = '<p style="color:#999; text-align:center;">Sem dados recentes</p>';
            } else {
                recentDiv.innerHTML = recent.map(a => `
                    <div style="padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between;">
                        <b>${a.nomePaciente}</b>
                        <span style="font-size:12px; color:#666">${a.status}</span>
                    </div>
                `).join('');
            }

            // Gráfico
            const ctx = document.getElementById('chartStatus').getContext('2d');
            if(chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Aguardando', 'Atendido', 'Outros'],
                    datasets: [{
                        data: [pending, done, total - pending - done],
                        backgroundColor: ['#f59e0b', '#10b981', '#cbd5e1'],
                        borderWidth: 0
                    }]
                },
                options: { responsive: true, cutout: '70%', plugins: { legend: { position: 'bottom' } } }
            });
        }

        // --- AUTH & NAV ---
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            const btn = document.getElementById('btnLogin');
            btn.innerText = "Carregando...";
            
            try {
                if (isLoginMode) await signInWithEmailAndPassword(auth, email, pass);
                else {
                    await createUserWithEmailAndPassword(auth, email, pass);
                    showToast("Conta criada!");
                }
            } catch (e) {
                showToast("Erro: " + e.message);
                btn.innerText = isLoginMode ? "Entrar" : "Cadastrar";
            }
        });

        document.getElementById('toggleRegister').onclick = () => {
            isLoginMode = !isLoginMode;
            document.getElementById('btnLogin').innerText = isLoginMode ? "Entrar" : "Cadastrar";
            document.getElementById('toggleRegister').innerText = isLoginMode ? "Não tem conta? Criar agora." : "Já tem conta? Entrar.";
        };

        window.nav = (tabId) => {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            // Lógica simples de menu ativo
            if(window.innerWidth < 768) document.getElementById('sidebar').classList.remove('open');
        };

        window.logout = () => signOut(auth);

        window.resetForm = () => {
            document.getElementById('formApp').reset();
            document.getElementById('editId').value = '';
        };

        window.showToast = (msg) => {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        };
        
        window.loadAppointments = loadAppointments;
    </script>
</body>
</html>
